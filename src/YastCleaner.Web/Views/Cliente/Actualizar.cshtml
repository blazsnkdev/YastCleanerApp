@model YastCleaner.Web.ViewModels.InsertarClienteViewModel

@{
    ViewData["Title"] = "Actualizar Cliente";
}

@section Styles {
    <link rel="stylesheet" href="~/css/ActualizarCliente.css" />
}

<div class="actualizar-cliente-container">
    <div class="actualizar-card">
        <!-- Header de la tarjeta -->
        <div class="card-header-custom">
            <div class="header-content">
                <i class="fas fa-user-edit me-3"></i>
                <div>
                    <h1 class="card-title">Actualizar Cliente</h1>
                    <p class="card-subtitle">Modifique la información del cliente</p>
                </div>
            </div>
            <div class="cliente-info">
                <a asp-action="Activos" asp-controller="Cliente" class="btn-volver-header">
                    <i class="fas fa-arrow-left me-2"></i>
                    Volver al Listado
                </a>
            </div>
        </div>

        <div class="card-body-custom">
            <!-- Alertas -->
            @if (TempData["Success"] != null)
            {
                <div class="alert-success-custom">
                    <i class="fas fa-check-circle"></i>
                    <span>@TempData["Success"]</span>
                    <button type="button" class="btn-cerrar-alerta" onclick="cerrarAlerta(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            }

            @if (TempData["Error"] != null)
            {
                <div class="alert-error-custom">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>@TempData["Error"]</span>
                    <button type="button" class="btn-cerrar-alerta" onclick="cerrarAlerta(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            }

            <form asp-action="Actualizar" asp-controller="Cliente" method="post" class="actualizar-form" id="actualizarForm">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="ClienteId" />

                <div class="form-grid">
                    <!-- Información Personal -->
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-user me-2"></i>
                            <h3>Información Personal</h3>
                        </div>

                        <div class="form-group-custom">
                            <label asp-for="Nombre" class="form-label-custom">
                                <i class="fas fa-signature me-2"></i>
                                Nombres *
                            </label>
                            <div class="input-group-custom">
                                <input asp-for="Nombre" class="form-control-custom" 
                                       placeholder="Ingrese los nombres del cliente"
                                       required />
                                <i class="fas fa-user input-icon"></i>
                            </div>
                            <span asp-validation-for="Nombre" class="validation-message"></span>
                            <div class="form-hint">
                                <i class="fas fa-lightbulb me-1"></i>
                                Ej: María Elena
                            </div>
                        </div>

                        <div class="apellidos-grid">
                            <div class="form-group-custom">
                                <label asp-for="ApellidoPaterno" class="form-label-custom">
                                    <i class="fas fa-signature me-2"></i>
                                    Apellido Paterno *
                                </label>
                                <div class="input-group-custom">
                                    <input asp-for="ApellidoPaterno" class="form-control-custom" 
                                           placeholder="Apellido paterno"
                                           required />
                                    <i class="fas fa-user input-icon"></i>
                                </div>
                                <span asp-validation-for="ApellidoPaterno" class="validation-message"></span>
                            </div>

                            <div class="form-group-custom">
                                <label asp-for="ApellidoMaterno" class="form-label-custom">
                                    <i class="fas fa-signature me-2"></i>
                                    Apellido Materno
                                </label>
                                <div class="input-group-custom">
                                    <input asp-for="ApellidoMaterno" class="form-control-custom" 
                                           placeholder="Apellido materno (opcional)" />
                                    <i class="fas fa-user input-icon"></i>
                                </div>
                                <span asp-validation-for="ApellidoMaterno" class="validation-message"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Información de Contacto -->
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-address-book me-2"></i>
                            <h3>Información de Contacto</h3>
                        </div>

                        <div class="form-group-custom">
                            <label asp-for="NumeroCelular" class="form-label-custom">
                                <i class="fas fa-mobile-alt me-2"></i>
                                Número de Celular *
                            </label>
                            <div class="input-group-custom celular-input">
                                <span class="input-prefix">+51</span>
                                <input asp-for="NumeroCelular" class="form-control-custom" 
                                       type="tel"
                                       maxlength="9"
                                       placeholder="9XXXXXXXX"
                                       pattern="[9][0-9]{8}"
                                       required />
                                <i class="fas fa-phone input-icon"></i>
                            </div>
                            <span asp-validation-for="NumeroCelular" class="validation-message"></span>
                            <div class="form-hint">
                                <i class="fas fa-lightbulb me-1"></i>
                                Formato: 9 dígitos que comienzan con 9
                            </div>
                        </div>

                        <div class="form-group-custom">
                            <label asp-for="Email" class="form-label-custom">
                                <i class="fas fa-envelope me-2"></i>
                                Correo Electrónico *
                            </label>
                            <div class="input-group-custom">
                                <input asp-for="Email" class="form-control-custom" 
                                       type="email"
                                       placeholder="cliente@ejemplo.com"
                                       required />
                                <i class="fas fa-at input-icon"></i>
                            </div>
                            <span asp-validation-for="Email" class="validation-message"></span>
                            <div class="form-hint">
                                <i class="fas fa-lightbulb me-1"></i>
                                Ejemplo: nombre@dominio.com
                            </div>
                        </div>

                        <div class="form-group-custom">
                            <label asp-for="Direccion" class="form-label-custom">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Dirección Completa *
                            </label>
                            <div class="input-group-custom">
                                <textarea asp-for="Direccion" class="form-control-custom textarea-custom" 
                                          rows="4"
                                          placeholder="Ingrese la dirección completa incluyendo distrito, ciudad y referencia..."
                                          required></textarea>
                                <i class="fas fa-home input-icon textarea-icon"></i>
                            </div>
                            <span asp-validation-for="Direccion" class="validation-message"></span>
                            <div class="form-hint">
                                <i class="fas fa-lightbulb me-1"></i>
                                Incluya referencia para mejor ubicación
                            </div>
                        </div>

                        <!-- Vista Previa -->
                        <div class="preview-section">
                            <div class="preview-header">
                                <i class="fas fa-eye me-2"></i>
                                <h4>Vista Previa</h4>
                            </div>
                            <div class="preview-content">
                                <div class="preview-card">
                                    <div class="preview-avatar">
                                        <i class="fas fa-user-circle"></i>
                                    </div>
                                    <div class="preview-info">
                                        <h5 id="previewNombreCompleto">@Model.Nombre @Model.ApellidoPaterno @Model.ApellidoMaterno</h5>
                                        <p class="preview-contacto">
                                            <i class="fas fa-phone"></i>
                                            <span id="previewCelular">+51 @Model.NumeroCelular</span>
                                        </p>
                                        <p class="preview-contacto">
                                            <i class="fas fa-envelope"></i>
                                            <span id="previewEmail">@Model.Email</span>
                                        </p>
                                        <p class="preview-direccion">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span id="previewDireccion">@Model.Direccion</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información Adicional -->
                <div class="info-adicional">
                    <div class="info-item">
                        <i class="fas fa-history text-info"></i>
                        <span>Última actualización: @DateTime.Now.ToString("dd/MM/yyyy HH:mm")</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-exclamation-triangle text-warning"></i>
                        <span>Los campos marcados con * son obligatorios</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-shield-alt text-success"></i>
                        <span>La información del cliente es confidencial y segura</span>
                    </div>
                </div>

                <!-- Acciones -->
                <div class="acciones-section">
                    <div class="acciones-grupo">
                        <a asp-action="Activos" asp-controller="Cliente" class="btn-cancelar">
                            <i class="fas fa-times me-2"></i>
                            Cancelar
                        </a>
                        
                        <button type="button" class="btn-limpiar" onclick="limpiarFormulario()">
                            <i class="fas fa-broom me-2"></i>
                            Limpiar Campos
                        </button>
                    </div>
                    
                    <button type="submit" class="btn-actualizar">
                        <i class="fas fa-save me-2"></i>
                        Actualizar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Confirmación -->
<div class="modal-confirmacion" id="modalConfirmacion">
    <div class="modal-content">
        <div class="modal-header">
            <i class="fas fa-clipboard-check text-primary me-2"></i>
            <h3>Confirmar Actualización</h3>
            <button type="button" class="btn-cerrar" onclick="cerrarModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="confirmacion-resumen">
                <h4>¿Está seguro que desea actualizar la información del cliente?</h4>
                <div class="resumen-datos">
                    <div class="resumen-item">
                        <strong>Nombre Completo:</strong>
                        <span id="resumenNombreCompleto"></span>
                    </div>
                    <div class="resumen-item">
                        <strong>Celular:</strong>
                        <span id="resumenCelular"></span>
                    </div>
                    <div class="resumen-item">
                        <strong>Email:</strong>
                        <span id="resumenEmail"></span>
                    </div>
                    <div class="resumen-item">
                        <strong>Dirección:</strong>
                        <span id="resumenDireccion"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal btn-cancelar" onclick="cerrarModal()">
                <i class="fas fa-times me-2"></i>
                Revisar Datos
            </button>
            <button type="button" class="btn-modal btn-confirmar" onclick="confirmarActualizacion()">
                <i class="fas fa-check me-2"></i>
                Sí, Actualizar
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const nombreInput = document.getElementById('Nombre');
            const apellidoPaternoInput = document.getElementById('ApellidoPaterno');
            const apellidoMaternoInput = document.getElementById('ApellidoMaterno');
            const celularInput = document.getElementById('NumeroCelular');
            const emailInput = document.getElementById('Email');
            const direccionInput = document.getElementById('Direccion');

            // Actualizar vista previa en tiempo real
            function actualizarVistaPrevia() {
                const nombreCompleto = `${nombreInput.value || ''} ${apellidoPaternoInput.value || ''} ${apellidoMaternoInput.value || ''}`.trim();
                document.getElementById('previewNombreCompleto').textContent = nombreCompleto || '@Model.Nombre @Model.ApellidoPaterno @Model.ApellidoMaterno';
                document.getElementById('previewCelular').textContent = '+51 ' + (celularInput.value || '@Model.NumeroCelular');
                document.getElementById('previewEmail').textContent = emailInput.value || '@Model.Email';
                document.getElementById('previewDireccion').textContent = direccionInput.value || '@Model.Direccion';
            }

            // Validar celular (solo números, 9 dígitos, comienza con 9)
            celularInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (this.value.length > 9) {
                    this.value = this.value.slice(0, 9);
                }
                if (this.value && !this.value.startsWith('9')) {
                    this.value = '9' + this.value.slice(1);
                }
                actualizarVistaPrevia();
            });

            // Validar email
            emailInput.addEventListener('blur', function() {
                const email = this.value;
                if (email && !isValidEmail(email)) {
                    this.classList.add('input-error');
                    mostrarError('Por favor ingrese un correo electrónico válido.');
                } else {
                    this.classList.remove('input-error');
                }
                actualizarVistaPrevia();
            });

            // Event listeners para actualizar vista previa
            nombreInput.addEventListener('input', actualizarVistaPrevia);
            apellidoPaternoInput.addEventListener('input', actualizarVistaPrevia);
            apellidoMaternoInput.addEventListener('input', actualizarVistaPrevia);
            direccionInput.addEventListener('input', actualizarVistaPrevia);

            // Validación del formulario
            const form = document.getElementById('actualizarForm');
            form.addEventListener('submit', function(e) {
                if (!validarFormulario()) {
                    e.preventDefault();
                    return;
                }

                // Mostrar modal de confirmación
                e.preventDefault();
                mostrarModalConfirmacion();
            });

            // Inicializar vista previa
            actualizarVistaPrevia();
        });

        function validarFormulario() {
            const celular = document.getElementById('NumeroCelular').value;
            const email = document.getElementById('Email').value;

            if (celular.length !== 9 || !celular.startsWith('9')) {
                mostrarError('El número de celular debe tener 9 dígitos y comenzar con 9.');
                return false;
            }

            if (email && !isValidEmail(email)) {
                mostrarError('Por favor ingrese un correo electrónico válido.');
                return false;
            }

            return true;
        }



        function mostrarModalConfirmacion() {
            document.getElementById('resumenNombreCompleto').textContent = 
                `${document.getElementById('Nombre').value} ${document.getElementById('ApellidoPaterno').value} ${document.getElementById('ApellidoMaterno').value}`;
            document.getElementById('resumenCelular').textContent = '+51 ' + document.getElementById('NumeroCelular').value;
            document.getElementById('resumenEmail').textContent = document.getElementById('Email').value;
            document.getElementById('resumenDireccion').textContent = document.getElementById('Direccion').value;

            document.getElementById('modalConfirmacion').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modalConfirmacion').style.display = 'none';
        }

        function confirmarActualizacion() {
            document.getElementById('actualizarForm').submit();
        }

        function limpiarFormulario() {
            if (confirm('¿Está seguro que desea limpiar todos los campos?')) {
                document.getElementById('actualizarForm').reset();
                // Restaurar valores originales en la vista previa
                setTimeout(() => {
                    const event = new Event('input');
                    document.getElementById('Nombre').dispatchEvent(event);
                    document.getElementById('ApellidoPaterno').dispatchEvent(event);
                    document.getElementById('ApellidoMaterno').dispatchEvent(event);
                }, 100);
            }
        }

        function cerrarAlerta(element) {
            element.parentElement.style.display = 'none';
        }

        function mostrarError(mensaje) {
            const notification = document.createElement('div');
            notification.className = 'error-notification';
            notification.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>
                ${mensaje}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 4000);
        }

        // Auto-formateo de nombres (primera letra mayúscula)
        document.getElementById('Nombre').addEventListener('blur', function() {
            this.value = this.value.replace(/\w\S*/g, function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        });

        document.getElementById('ApellidoPaterno').addEventListener('blur', function() {
            this.value = this.value.replace(/\w\S*/g, function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        });

        document.getElementById('ApellidoMaterno').addEventListener('blur', function() {
            this.value = this.value.replace(/\w\S*/g, function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        });
    </script>
}