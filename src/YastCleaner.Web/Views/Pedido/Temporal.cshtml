@model IEnumerable<YastCleaner.Web.ViewModels.PedidosTemporalViewModel>

@{
    ViewData["Title"] = "Carrito de Pedidos";
    double totalPagar = ViewBag.Importe ?? 0;
}

<h1 class="mb-4 text-center">Servicios Seleccionado en el Carrito</h1>

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Nombre del Servicio</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Importe</th>
                    <th colspan="2" class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="align-middle">@Html.DisplayFor(modelItem => item.Id)</td>
                        <td class="align-middle">@Html.DisplayFor(modelItem => item.Nombre)</td>
                        <td class="align-middle">
                            <form asp-controller="Pedido" asp-action="ModificarCantidad" method="post" class="d-inline">
                                @Html.Hidden("servicioId", item.Id)
                                <div class="input-group input-group-sm" style="width: 120px;">
                                    <input type="number"
                                           name="cantidad"
                                           value="@item.Cantidad"
                                           min="1"
                                           class="form-control"
                                           required />
                                    <button type="submit" class="btn btn-outline-primary btn-sm" title="Actualizar cantidad">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </form>
                        </td>
                        <td class="align-middle text-success fw-bold">
                            S/ @Html.DisplayFor(modelItem => item.Precio)
                        </td>
                        <td class="align-middle text-success fw-bold">
                            S/ @Html.DisplayFor(modelItem => item.Importe)
                        </td>
                        <td class="align-middle text-center">
                            <form asp-controller="Pedido" asp-action="EliminarServicio" method="post" class="d-inline">
                                @Html.Hidden("servicioId", item.Id)
                                <button type="submit"
                                        class="btn btn-danger btn-sm"
                                        onclick="return confirm('¿Estás seguro de eliminar este servicio del carrito?')"
                                        title="Eliminar servicio">
                                    <i class="fas fa-trash"></i> Eliminar
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Resumen del Pedido -->
    <div class="row mt-4">
        <div class="col-md-6 offset-md-6">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">Resumen del Pedido</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <span class="fw-bold fs-5">Total a Pagar:</span>
                        <span class="fw-bold fs-5 text-success">S/ @totalPagar.ToString("N2")</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Botones de acción final -->
    <div class="d-flex justify-content-between mt-4">
        <a asp-controller="Servicio" asp-action="Servicios" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Continuar Comprando
        </a>
        <div>
            <a asp-controller="Pedido" asp-action="Limpiar"
               class="btn btn-warning me-2"
               onclick="return confirm('¿Estás seguro de limpiar todo el carrito?')">
                <i class="fas fa-broom"></i> Limpiar Carrito
            </a>
            <a asp-controller="Pedido" asp-action="RegistrarPedido" class="btn btn-success btn-lg">
                <i class="fas fa-check-circle"></i> Finalizar Pedido
            </a>
        </div>
    </div>
}
else
{
    <div class="alert alert-info text-center">
        <h4>Carrito Vacío</h4>
        <p>No hay servicios agregados al carrito.</p>
        <a asp-controller="Servicio" asp-action="Servicios" class="btn btn-primary">
            <i class="fas fa-shopping-cart"></i> Agregar Servicios
        </a>
    </div>
}
